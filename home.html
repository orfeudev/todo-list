<html>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="assets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>home.html</title>
</head>
<body>
    <header>
        <h1 class="titulo">To-do List</h1>    
    </header>
    <main>
        <div class="mainForm">
            <form class="form">
                <input type="text" id="inputField"> 
                <input type="submit" value="Enviar" id="submitButton">
            </form>
        </div>
        <div class="container">
            <div class="atividades" id="atividades"></div>
        </div>

        <script>
            // use addEventListener to update the DOM when new item added
            window.addEventListener('DOMContentLoaded', function () {

                // setup variables
                let list = [];
                const inputField = document.getElementById('inputField');
                const submitButton = document.getElementById('submitButton');
                const itemList = document.getElementById('atividades');
        
                // create item when submitButton gets a click and store any data on inputField.
                submitButton.addEventListener('click', function () {
                    createNewItem(inputField.value);
                });
                
                // create item when enter key is pressed and store any data on inputField.
                inputField.addEventListener('keyup', function (event) {
                    if (event.key === 'Enter') {
                        createNewItem(inputField.value);
                    }
                });
                
                // this function pushes the new item inside the list array,
                // save to localStorage and reload the DOM.
                function createNewItem(itemName) {
                    list.push({ name: itemName });
                    saveListToLocalStorage();
                    renderList();
                    console.log(list);
                }
                
                // this function deletes the item, locates by it's index,
                // remove using splice, saves the new array on the localStorage
                // and reload the DOM.
                function deleteItem(item) {
                    const index = list.indexOf(item);
                    if (index > -1) {
                        list.splice(index, 1);
                        saveListToLocalStorage();
                        renderList();
                        console.log(list);
                    }
                }
                
                // this function just saves use simplify the process of
                // saving the new item to the localStorage using
                // JSON.stringify function to make sure it saves as json object.
                function saveListToLocalStorage() {
                    localStorage.setItem('list', JSON.stringify(list));
                }
                
                // this function fetches all items on the list, pretty much the
                // whole json object, it uses JSON.parse function to parse each
                // item on the array so it's easier to use it on the DOM render function;
                function loadListFromLocalStorage() {
                    const storedList = localStorage.getItem('list');
                    if (storedList) {
                        list = JSON.parse(storedList);
                    }
                }
                

                // Pretty complex function, in short, it just creates a new div
                // when a new item is created, it interate through the list variable
                // and create a new div with 'atividade' class and a buttom that
                // accept the item id as parameter, which is determinated
                // by it's index value on the array list.
                function renderList() {
                    itemList.innerHTML = '';
                    list.forEach(function (item) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'atividade';
                        const itemNameSpan = document.createElement('span');
                        itemNameSpan.textContent = item.name;
                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'botaoAtividade';
                        deleteButton.innerHTML = '<i class="fa-solid fa-xmark"></i>';
                        deleteButton.addEventListener('click', function () {
                            deleteItem(item);
                        });
                        itemDiv.appendChild(itemNameSpan);
                        itemDiv.appendChild(deleteButton);
                        itemList.appendChild(itemDiv);
                    });
                }
                
                // loads from the localStorage all items saved and 
                // render on DOM.
                loadListFromLocalStorage();
                renderList();
            });
        </script>
        
    </main>
    <footer>
        <!-- to do -->
    </footer>
</body>
</html>